<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathing Exercise - MindWellness</title>
    <link rel="icon" type="image/png" href="assets/fav.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/breathing.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid px-4">
            <a class="navbar-brand d-flex align-items-center" href="dashboard.html">
                <i class="bi bi-heart-pulse-fill me-2"></i>
                MindWellness
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="dashboard.html">
                            <i class="bi bi-grid-fill me-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="journal.html">
                            <i class="bi bi-journal-text me-2"></i>
                            Journal
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active d-flex align-items-center" href="activities.html">
                            <i class="bi bi-list-check me-2"></i>
                            Activities
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="chatbot.html">
                            <i class="bi bi-chat-dots-fill me-2"></i>
                            Chat Support
                        </a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <a class="nav-link d-flex align-items-center" href="#" id="logoutBtn">
                        <i class="bi bi-box-arrow-right me-2"></i>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Breathing Exercise</h2>
            <a href="activities.html" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left me-2"></i>Back to Activities
            </a>
        </div>
        
        <div class="card">
            <div class="card-body">
                <h3 class="card-title">
                    <i class="bi bi-wind me-2"></i>Breathing Exercise
                </h3>
                <p class="card-text">Take a moment to relax with this guided breathing exercise.</p>
                
                <div class="breathing-circle" id="breathingCircle">
                    Click to Start
                </div>
                
                <div class="text-center mb-3">
                    <div id="breathingText" class="h4 mb-3">Ready to begin</div>
                    <button class="btn btn-primary" onclick="toggleBreathing()" id="breathingButton">
                        Start Exercise
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let isBreathing = false;
        let breathingInterval;

        function toggleBreathing() {
            const button = document.getElementById('breathingButton');
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');

            if (!isBreathing) {
                button.textContent = 'Stop Exercise';
                startBreathing();
            } else {
                button.textContent = 'Start Exercise';
                clearInterval(breathingInterval);
                circle.textContent = 'Click to Start';
                text.textContent = 'Ready to begin';
                circle.classList.remove('inhale', 'exhale');
            }
            isBreathing = !isBreathing;
        }

        function startBreathing() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            let phase = 'inhale';
            let count = 4;

            function updateBreathing() {
                if (phase === 'inhale') {
                    if (count === 4) {
                        circle.classList.add('inhale');
                        circle.classList.remove('exhale');
                        text.textContent = 'Inhale...';
                        circle.textContent = count;
                    } else if (count > 0) {
                        circle.textContent = count;
                    } else {
                        phase = 'hold1';
                        count = 7;
                        text.textContent = 'Hold...';
                        circle.textContent = count;
                    }
                } else if (phase === 'hold1') {
                    if (count > 0) {
                        circle.textContent = count;
                    } else {
                        phase = 'exhale';
                        count = 8;
                        circle.classList.remove('inhale');
                        circle.classList.add('exhale');
                        text.textContent = 'Exhale...';
                        circle.textContent = count;
                    }
                } else if (phase === 'exhale') {
                    if (count > 0) {
                        circle.textContent = count;
                    } else {
                        phase = 'hold2';
                        count = 0;
                        text.textContent = 'Hold...';
                        circle.textContent = count;
                    }
                } else { // hold2
                    if (count < 4) {
                        circle.textContent = count;
                    } else {
                        phase = 'inhale';
                        count = 4;
                        text.textContent = 'Inhale...';
                        circle.textContent = count;
                    }
                }
                count = phase === 'hold2' ? count + 1 : count - 1;
            }

            updateBreathing();
            breathingInterval = setInterval(updateBreathing, 1000);
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            try {
                await fetch('api/logout.php', {
                    method: 'POST',
                    credentials: 'include'
                });
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to logout. Please try again.');
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindWellness - Mindful Coloring</title>
    <link rel="icon" type="image/png" href="assets/fav.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/color.css">

</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid px-4">
            <a class="navbar-brand d-flex align-items-center" href="dashboard.html">
                <i class="bi bi-heart-pulse-fill me-2"></i>
                MindWellness
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="dashboard.html">
                            <i class="bi bi-grid-fill me-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="journal.html">
                            <i class="bi bi-journal-text me-2"></i>
                            Journal
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active d-flex align-items-center" href="activities.html">
                            <i class="bi bi-list-check me-2"></i>
                            Activities
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="chatbot.html">
                            <i class="bi bi-chat-dots-fill me-2"></i>
                            Chat Support
                        </a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <a class="nav-link d-flex align-items-center" href="#" id="logoutBtn">
                        <i class="bi bi-box-arrow-right me-2"></i>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Mindful Coloring</h2>
            <a href="activities.html" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left me-2"></i>Back to Activities
            </a>
        </div>
        
        <div class="card">
            <div class="card-body">
                <h3 class="card-title">
                    <i class="bi bi-palette me-2"></i>Mindful Coloring
                </h3>
                <p class="card-text">Express yourself through colors and shapes. Let your creativity flow.</p>
                
                <div class="color-picker" id="colorPicker">
                    <div class="color-option selected" style="background-color: #000000" data-color="#000000"></div>
                    <div class="color-option" style="background-color: #bd2222" data-color="#bd2222"></div>
                    <div class="color-option" style="background-color: #dd9d37" data-color="#dd9d37"></div>
                    <div class="color-option" style="background-color: #e9e961" data-color="#e9e961"></div>
                    <div class="color-option" style="background-color: #81c556" data-color="#81c556"></div>
                    <div class="color-option" style="background-color: #4480cd" data-color="#4480cd"></div>
                    <div class="color-option" style="background-color: #7db7e3" data-color="#7db7e3"></div>
                    <div class="color-option" style="background-color: #e54da0" data-color="#e54da0"></div>
                    <div class="color-option" style="background-color: #954fa8" data-color="#954fa8"></div>
                </div>
                
                <div class="mb-3">
                    <label for="brushSize" class="form-label">Brush Size:</label>
                    <input type="range" class="brush-size form-range" id="brushSize" min="1" max="50" value="5">
                </div>
                
                <canvas id="coloringCanvas" class="coloring-canvas" width="800" height="600"></canvas>
                
                <div class="mt-3">
                    <button class="btn btn-secondary me-2" onclick="clearCanvas()">Clear Canvas</button>
                    <button class="btn btn-primary" onclick="downloadDrawing()">Download Drawing</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const canvas = document.getElementById('coloringCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let currentColor = '#000000';
        let currentSize = 5;

        // Set canvas background to white
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Color picker functionality
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelector('.color-option.selected').classList.remove('selected');
                this.classList.add('selected');
                currentColor = this.dataset.color;
            });
        });

        // Brush size functionality
        document.getElementById('brushSize').addEventListener('input', function() {
            currentSize = this.value;
        });

        // Drawing functionality
        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.fillStyle = currentColor;
            ctx.beginPath();
            ctx.arc(x, y, currentSize / 2, 0, Math.PI * 2);
            ctx.fill();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearCanvas() {
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function downloadDrawing() {
            const link = document.createElement('a');
            link.download = 'mindful-drawing.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch events for mobile devices
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchend', function(e) {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            try {
                await fetch('api/logout.php', {
                    method: 'POST',
                    credentials: 'include'
                });
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to logout. Please try again.');
            }
        });
    </script>
</body>
</html>
